image: jangrewe/gitlab-ci-android

stages:
  - build

variables:
  ANDROID_COMPILE_SDK: "34"
  ANDROID_BUILD_TOOLS: "34.0.0"
  ANDROID_SDK_TOOLS: "9477386"
  GRADLE_OPTS: "-Dorg.gradle.daemon=false"

before_script:
  - export GRADLE_USER_HOME=$(pwd)/.gradle
  - chmod +x ./gradlew 2>/dev/null || true

cache:
  key: ${CI_PROJECT_ID}
  paths:
    - .gradle/

build:
  stage: build
  script:
    - |
      if [ -f "./gradlew" ]; then
        ./gradlew assembleDebug --no-daemon --stacktrace
      else
        echo "Gradle wrapper not found. Using system Gradle from Docker image."
        gradle assembleDebug --no-daemon --stacktrace
      fi
  artifacts:
    paths:
      - app/build/outputs/apk/debug/app-debug.apk
    expire_in: 1 week
  only:
    - main
    - master
    - branches
